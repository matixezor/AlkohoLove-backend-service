services:
  backend:
    build: .
    command: uvicorn src.main:app --host 0.0.0.0
    volumes:
      - .:/src
    ports:
      - 8008:8000
    environment:
      - DATABASE_URL=mongodb://alkoholove_admin:Test1234@mongodb/alkoholove?retryWrites=true&w=majority
      - STATIC_DIR=./static
    depends_on:
      - mongodb
  mongodb:
    image: mongo:5.0.8
    restart: always
    ports:
      - 27017:27017
    environment:
      - MONGO_INITDB_ROOT_USERNAME=alkoholove_admin
      - MONGO_INITDB_ROOT_PASSWORD=Test1234
      - MONGO_INITDB_DATABASE=alkoholove
    volumes:
      - ./init_db/001-users_collection.js:/docker-entrypoint-initdb.d/001-users_collection.js:ro
      - ./init_db/002-tokens_collection.js:/docker-entrypoint-initdb.d/002-tokens_collection.js:ro
      - ./init_db/003-errors_collection.js:/docker-entrypoint-initdb.d/003-errors_collection.js:ro
      - ./init_db/004-alcohol_collections.js:/docker-entrypoint-initdb.d/004-alcohol_collections.js:ro
      - ./init_db/009-followers_collection.js:/docker-entrypoint-initdb.d/009-followers_collection.js:ro
      - ./init_db/010-following_collection.js:/docker-entrypoint-initdb.d/010-following_collection.js:ro
      - ./mongo-data/:/data/db
